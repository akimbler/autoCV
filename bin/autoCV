#!/usr/bin/env python3
"""
main script for autoCV
"""

import os
import argparse
from autocv.researcher import Researcher
from autocv.latex import LatexCV


if __name__ == "__main__":

    # parse arguments
    parser = argparse.ArgumentParser(
        description='Automated CV generation')
    parser.add_argument('-b', '--basedir',
                        help='base directory')
    parser.add_argument('-o', '--outfile',
                        help='Name of output .tex file')
    args = parser.parse_args()

    # set up base directory
    if args.basedir is not None:
        basedir = args.basedir
    else:
        basedir = './'
    print("using basedir:", basedir)

    paramfile = os.path.join(basedir, 'params.json')
    assert os.path.exists(paramfile)
    r = Researcher(paramfile)
    r.get_orcid_data()
    r.get_orcid_dois()
    r.get_pubmed_data()
    r.get_google_scholar_record()
    r.get_patents()
    r.make_publication_records()
    r.to_json('test.json')
    latex = LatexCV(r)
    latex.render_latex()
    latex.load_template_files()

    if args.outfile is not None:
        outfile = args.outfile
    else:
        outfile = os.path.join(
            basedir,
            '%s_%s_cv.tex' % (
                r.firstname,
                r.lastname
            )
        )
    latex.write_latex(outfile)
